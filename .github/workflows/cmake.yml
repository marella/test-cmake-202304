name: cmake
on:
  - workflow_dispatch

jobs:
  test:
    name: ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os:
          - macos-latest

    steps:
      - uses: actions/checkout@v3
      - name: Build
        run: |
          mkdir build
          cd build
          git clone --recurse-submodules https://github.com/marella/gptj.cpp
          cd gptj.cpp
          
          mkdir build
          cd build
          cmake ..
          cmake --build . --config Release
      - uses: git-actions/set-user@v1
      - name: Save
        run: |
          cp build/gptj.cpp/build/src/libgptj.dylib lib
          cp build/gptj.cpp/build/ggml/src/libggml.dylib lib
          git add --all
          git commit -m 'Build ${{ matrix.os }}'
          git push
